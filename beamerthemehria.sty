% SPDX-FileCopyrightText: 2026 Alexandru Fikl <alexfikl@gmail.com>
% SPDX-License-Identifier: CC-BY-4.0
%
% This is an unofficial Breamer theme for the HRIA project (Romanian Hub for Artificla
% Intelligence).
%
% Usage:
%   \usetheme[options]{hria}
%
% References:
%   - News article: https://www.marketwatch.ro/articol/18823/Hub-ul_Roman_de_Inteligenta_Artificiala__motor_pentru_inovatie_si_competitivitate__la_nivel_european/
%   - Official brochure: https://hria.upb.ro/wp-content/uploads/2025/06/HRIA-Brosura-06-2025.pdf
%   - EU logos: https://ec.europa.eu/regional_policy/information-sources/logo-download-center_en
%   - UVT logos: https://www.uvt.ro/dcimi/identitate-vizuala/

\def\fileversion{v0.3}
\def\filedate{2026/02/28}

\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{beamerthemehria}[\filedate \fileversion HRIA Beamer Theme]

% <<< options

\RequirePackage{ifthen}
\RequirePackage{kvoptions}
\SetupKeyvalOptions{
    family=hria,
    prefix=hria@
}

% select language for logos
\DeclareStringOption[english]{language}
% show a debug layout grid
\DeclareBoolOption[false]{showframe}
\DeclareBoolOption[false]{layoutgrid}

\ProcessOptionsBeamer
\DeclareDefaultOption{\PackageWarning{beamerthemehria}{Unknown option `\CurrentOption`}}
\ProcessKeyvalOptions*

% >>>

% <<< packages

\RequirePackage{ifpdf}
\RequirePackage{xparse}
\RequirePackage{csquotes}

% used in defining blocks
\RequirePackage{adjustbox}
\RequirePackage{colortbl}
% handle font sizes by different increments
\RequirePackage{relsize}

% fancy graphics
\RequirePackage{tikz}

\ifhria@showframe
    \RequirePackage{showframe}
\fi

\ifhria@layoutgrid
    \RequirePackage[
        grid,
        gridunit=cm,
        gridcolor=gray!70,
        subgridcolor=gray!70,
        texcoord]{eso-pic}
\fi

% >>>

% <<< formatting

\usecolortheme{hria}

\hypersetup{%
    colorlinks=true,
    urlcolor=HRIALightBlue,
    citecolor=HRIALightBlue,
    linkcolor=HRIALightBlue
}
\renewcommand{\UrlFont}{\bfseries\ttfamily}

% >>>

% <<< commands

\ProvideDocumentCommand \hrialogo { m } {\def\hria@logo{#1}}
\ProvideDocumentCommand \hrialogoeu { m } {\def\hria@logoeu{#1}}
\ProvideDocumentCommand \hrialogoro { m } {\def\hria@logoro{#1}}

\ProvideDocumentCommand \hriaurl { m } {\def\hria@url{#1}}
\ProvideDocumentCommand \hriafunding { +m } {\def\hria@funding{#1}}

\ProvideDocumentCommand \venue { m } {\def\hria@venue{#1}}

% >>>

% <<< assets

\RequirePackage{ifthen}

\ifthenelse{\equal{\hria@language}{english}}{
    \hrialogoeu{\includegraphics[width=0.57\paperheight]{assets/logo-cofunded-eu-en}}
    \hrialogoro{\includegraphics[width=0.15\paperheight]{assets/logo-gov-ro}}
    \hrialogo{\includegraphics[width=0.45\paperheight]{assets/logo-hria-en}}
    \hriaurl{https://hria.upb.ro/en/}
    \hriafunding{This research was supported by the project \enquote{Romanian Hub for Artificial Intelligence -- HRIA}, Smart Growth, Digitization and Financial Instruments Program, 2021-2027, MySMIS no. 351416. Any opinions, findings, and conclusions or recommendations expressed in this material are
those of the author(s) and do not necessarily reflect the views of the funding agencies.
}
}{
\ifthenelse{\equal{\hria@language}{romanian}}{
    \hrialogoeu{\includegraphics[width=0.57\paperheight]{assets/logo-cofunded-eu-ro}}
    \hrialogoro{\includegraphics[width=0.15\paperheight]{assets/logo-gov-ro}}
    \hrialogo{\includegraphics[width=0.45\paperheight]{assets/logo-hria-ro}}
    \hriaurl{https://hria.upb.ro/}
    \hriafunding{Această lucrare a fost sprijinită prin proiectul \enquote{Hub Român de Inteligență Artificială -- HRIA}, Programul Creștere Inteligentă, Digitalizare și Instrumente Financiare 2021–2027, MySMIS nr. 351416. Orice opinii și concluzii sau recomandări exprimate în acest material sunt cele ale autorului (autorilor) și nu reflectă în mod necesar punctele de vedere ale agențiilor finanțatoare.}
}{
    \PackageError{beamerthemehria}{Unknown language `\hria@language`}{}
}}

\ProvideDocumentCommand \inserthriafunding {} {\hria@funding}
\ProvideDocumentCommand \inserthriaurl {} {\hria@url}
\NewDocumentCommand \inserthriaqrcode {} {%
    \hypersetup{urlcolor=black}%
    \expandafter\qrcode\expandafter[height=0.2\paperwidth]{\hria@url}%
}

% >>>

% <<< fonts

\ifpdftex
    \RequirePackage[utf8]{inputenc}
    \RequirePackage[T1]{fontenc}
\else
    \RequirePackage{fontspec}
\fi

\renewcommand{\familydefault}{\sfdefault}

\setbeamerfont{title}{size=\huge, series=\bfseries}
\setbeamerfont*{subtitle}{size=\large, series=\mdseries}
\setbeamerfont{author}{size=\normalsize, series=\bfseries}
\setbeamerfont{date}{size=\small, series=\mdseries}

\setbeamerfont{frametitle}{size=\huge, series=\bfseries}
\setbeamerfont{framesubtitle}{size=\normalsize, series=\mdseries}

\setbeamerfont{section title}{size=\LARGE,series=\bfseries}

\setbeamerfont{alerted text}{series=\bfseries}
\setbeamerfont{block title}{size=\relsize{+1},series=\bfseries}
\setbeamerfont{block title alerted}{size=\relsize{+1},series=\bfseries}

\setbeamerfont{page number in head/foot}{size=\footnotesize, series=\bfseries}
\setbeamerfont{url text}{size=\scriptsize,series=\bfseries}
\setbeamerfont{author in head/foot}{size=\scriptsize,series=\bfseries}

\setbeamerfont{enumerate item}{size={}, series=\bfseries}
\setbeamerfont{description item}{size={}, series=\bfseries}

\setbeamerfont{itemize/enumerate body}{size={}}
\setbeamerfont{itemize/enumerate subbody}{size={}}
\setbeamerfont{itemize/enumerate subsubbody}{size={}}

% >>>

% <<< outer: header / footer

\defbeamertemplate*{frametitle}{hriaframe}{
\vspace{13pt}
\begin{beamercolorbox}[wd=\paperwidth, leftskip=30mm]{frametitle}
\ifx\insertframesubtitle\empty
    {\vspace{10pt}\usebeamerfont{frametitle}\usebeamercolor[fg]{frametitle}\insertframetitle}
\else
    {\usebeamerfont{frametitle}\usebeamercolor[fg]{frametitle}\insertframetitle}\\[-11pt]
    {\usebeamerfont{framesubtitle}\usebeamercolor[fg]{framesubtitle}\insertframesubtitle}
\fi
\end{beamercolorbox}
\vspace{-9pt}
}

\defbeamertemplate{footline}{hriaframe}{
\begin{beamercolorbox}[ht=0.6cm,dp=0pt]{footline}
\begin{tikzpicture}[remember picture, overlay]
\node [
    draw=HRIAGreen,
    fill=HRIAGreen,
    rounded corners=6pt,
    inner sep=2pt,
    align=left,
    text width=0.5\textwidth,
    minimum width=0.5\textwidth,
    anchor=west,
    yshift=11pt,xshift=15mm]
    (0, 0) {
        \usebeamercolor[fg]{page number in head/foot}
        \usebeamerfont{page number in head/foot}
        \@ifundefined{hria@venue}{%
            \hypersetup{urlcolor=white}HRIA @ \url{\hria@url}
        }{%
            \hypersetup{urlcolor=white}\par\usebeamerfont{venue}\hria@venue
        }
    };
\node [
    draw=HRIAGreen,
    fill=HRIAGreen,
    rounded corners=6pt,
    inner sep=2pt,
    align=right,
    anchor=east,
    yshift=11pt,xshift=\textwidth-8mm]
    (0, 0) {
        \usebeamercolor[fg]{page number in head/foot}
        \usebeamerfont{page number in head/foot}
        \insertframenumber~/~\inserttotalframenumber
    };
\draw [
    HRIAGreen,
    rounded corners=6pt]
    ([yshift=5pt, xshift=15mm]current page.south west)
    rectangle ([yshift=17pt, xshift=-23pt]current page.south east);
\end{tikzpicture}
\end{beamercolorbox}
}
\setbeamertemplate{footline}[hriaframe]

% >>>

% <<< inner: environments

% <<< templates

\setbeamertemplate{background}[hriaslide]

\NewDocumentCommand \titleframe {} {
    \setbeamertemplate{title page}[hriatitlepage]
    \setbeamertemplate{background}[hriatitlepage]
    \frame[plain,noframenumbering]{\titlepage}
    \setbeamertemplate{background}[hriaslide]
}

% >>>

% <<< title page

\defbeamertemplate{title page}{hriatitlepage}
{
\begin{center}
    \bigskip
    % title format
    \usebeamerfont{title}\usebeamercolor[fg]{title}
    \inserttitle\par
    % subtitle
    \usebeamerfont{subtitle}\insertsubtitle\par%
    \bigskip
    % author
    \usebeamerfont{author}\insertauthor\par%
    \bigskip
    % institution
    \usebeamerfont{date}\insertinstitute\par
    \usebeamerfont{date}\insertdate%
\end{center}
}

% >>>

% <<< background

\defbeamertemplate{background}{hriatitlepage}
{
\begin{tikzpicture}[remember picture,overlay]
% top logos
\node[anchor=north west,inner sep=12pt] at (current page.north west) {\hria@logoeu};
\node[anchor=north east,inner sep=14pt, yshift=5pt] at (current page.north east) {\hria@logoro};

% top separator
\fill [HRIALightBlue] ([yshift=-66.5pt]current page.north west) rectangle (20mm, -56.5pt);
\fill [HRIADarkBlue] ([xshift=22mm, yshift=-66.5pt]current page.north west) rectangle (\paperwidth, -56.5pt);

% bottom logos
\node[anchor=south] at (current page.south) {\hria@logo};
\end{tikzpicture}
}

\defbeamertemplate{background}{hriaslide}{
\begin{tikzpicture}[remember picture,overlay]
\node[anchor=north west, xshift=4mm, yshift=-0.75mm] at (current page.north west) {\scalebox{0.475}{\hria@logo}};
\fill[HRIALightBlue, inner sep=0pt]
    (-0.88\paperheight, -0.5\paperheight) circle (\paperheight);
\end{tikzpicture}
}

% >>>

% <<< itemize

% FIXME: figure out how to ensure that the bullets are actually in the middle of the text line?

\setbeamertemplate{itemize item}{
\tikz[baseline=(c.south)]{
    % circle
    \node[
      circle,
      fill=HRIALightBlue,
      minimum size=0.75em,
      inner sep=0pt
    ] (c) {};

    % compute radius
    \pgfmathsetmacro{\r}{0.05}

    % draw thick >
    \draw[
      white,
      line width=0.1em,
      line cap=round,
      line join=round
    ] (-\r, \r) -- (\r, 0) -- (-\r, -\r);
  }%
}

\def\hria@subitemsize{0.35ex}
\setbeamertemplate{itemize subitem}{\color{HRIALightBlue}$\bullet$}

\setbeamertemplate{itemize subsubitem}{\color{HRIALightBlue}\rule[0.5ex]{0.75ex}{0.3ex}}

% >>>

% <<< blocks

\setbeamertemplate{block begin}{
    \vspace{\fill}
    \begin{adjustbox}{max width=0.98\textwidth}
        \begin{tabular}{!{\color{HRIADarkBlue}{\vrule width 4pt}}>{\columncolor[gray]{0.97}}m{\textwidth}}
    	    \begin{beamercolorbox}{block title}
                \usebeamerfont*{block title}
                \vbox{}\vskip 0.05ex
                \insertblocktitle
                \vbox{}\vskip 0.2ex
            \end{beamercolorbox}
            \usebeamerfont*{block text}
}
\setbeamertemplate{block end}{\end{tabular}\end{adjustbox}}

\setbeamertemplate{block alerted begin}{
    \vspace{\fill}
    \begin{adjustbox}{max width=0.98\textwidth}
        \begin{tabular}{!{\color{HRIAGreen}{\vrule width 4pt}}>{\columncolor[gray]{0.97}}m{\textwidth}}
    	    \begin{beamercolorbox}{alerted text}
                \usebeamerfont*{block title}
                \vbox{}\vskip 0.05ex
                \insertblocktitle
                \vbox{}\vskip 0.2ex
            \end{beamercolorbox}
            \usebeamerfont*{block text}
}
\setbeamertemplate{block alerted end}{\end{tabular}\end{adjustbox}}

\setbeamertemplate{block example begin}{
    \vspace{\fill}
    \begin{adjustbox}{max width=0.98\textwidth}
        \begin{tabular}{!{\color{HRIALightBlue}{\vrule width 4pt}}>{\columncolor[gray]{0.97}}m{\textwidth}}
    	    \begin{beamercolorbox}{example text}
                \usebeamerfont*{block title}
                \vbox{}\vskip 0.05ex
                \insertblocktitle
                \vbox{}\vskip 0.2ex
            \end{beamercolorbox}
            \usebeamerfont*{block text}
}
\setbeamertemplate{block example end}{\end{tabular}\end{adjustbox}}

% >>>

% <<< figures

% disable "Figure:" in the captions
\setbeamertemplate{caption}{\insertcaption}
\setbeamertemplate{caption label separator}{}

% >>>

\setbeamersize{
    text margin left=15mm,
    text margin right=.05\paperwidth,
    description width=0.075\paperwidth,
    }
\setlength{\labelsep}{\dimexpr\labelsep - 0.2em\relax}

% >>>

%% vim: foldmarker=<<<,>>>:foldmethod=marker:nospell:filetype=tex
